05/01/25

devel@pi5-90:~ $ git clone https://github.com/develone/pico-ice.git -b test-dev-100424
devel@pi5-90:~ $ cd pico-ice/PipelineC/pmod-ethernet/examples/pico-ice/ice_makefile_pipelinec/
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/pico-ice/ice_makefile_pipelinec $ ls
build.sh         ice40.pcf      pll.v       top.h
eth_clocks.py    lextab.py      pong_top.c  top_pins.svh
ethernet_top.c   Makefile       README.md   top.sv
ethernet_top.sv  pll_clk_mhz.h  top.c       yacctab.py
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/pico-ice/ice_makefile_pipelinec $ ./build.sh 
rm -f lextab.py
rm -f yacctab.py
rm -f pll_clk_mhz.h
rm -f -r pipelinec_output
rm -f pipelinec.log
rm -f pll.v
rm -f *.json *.asc *.bin *.uf2
rm -f yosys_stderr.log
rm -f dfu_util.log
echo "#define PLL_CLK_MHZ 25.0\n" > pll_clk_mhz.h
/home/devel/PipelineC/src/pipelinec ethernet_top.c --top pipelinec_top --out_dir pipelinec_output --comb --no_synth > pipelinec.log
/home/devel/oss-cad-suite//bin/icepll -q -i 12 -o 25.0 -p -m -f pll.v
/home/devel/oss-cad-suite//bin/yosys -l simple.log -q -m ghdl -p "ghdl --std=08 -frelaxed `cat pipelinec_output/vhdl_files.txt` -e pipelinec_top; read_verilog -sv ethernet_top.sv pll.v; synth_ice40 -top ethernet_top -json gateware.json" 2> yosys_stderr.log
/home/devel/oss-cad-suite//bin/nextpnr-ice40 -l nextpnr.log -q --randomize-seed --up5k --package sg48 --pcf ice40.pcf --json gateware.json --asc gateware.asc --pre-pack eth_clocks.py
/home/devel/oss-cad-suite//bin/icepack gateware.asc gateware.bin
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/pico-ice/ice_makefile_pipelinec $ cp gateware.bin ~/master-repos/pico-ice/PipelineC/pmod-ethernet/test_mpremote/ethernet.bin
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/pico-ice/ice_makefile_pipelinec $ shasum gateware.bin
e0dee97a3b402185b235e6cba3b1c5004ff4f387  gateware.bin
devel@pi5-90:~/master-repos/pico-ice/PipelineC/pmod-ethernet $ shasum test_mpremote/ethernet.bin 
e0dee97a3b402185b235e6cba3b1c5004ff4f387  test_mpremote/ethernet.bin
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/net $ ./compile-work_test.sh
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/net $ ls -la
total 84
drwxr-xr-x 2 devel devel  4096 May  2 13:44 .
drwxr-xr-x 4 devel devel  4096 Apr 27 06:48 ..
-rwxr-xr-x 1 devel devel   130 Apr 27 06:48 compile-work_test.sh
-rw-r--r-- 1 devel devel  6868 Apr 27 06:48 eth_sw.c
-rw-r--r-- 1 devel devel   684 Apr 27 06:48 eth_work.h
-rw-r--r-- 1 devel devel   402 Apr 27 06:48 fpga_mac.h
-rw-r--r-- 1 devel devel  4257 Apr 27 06:48 loopback_app.c
-rw-r--r-- 1 devel devel  1677 Apr 27 06:48 loopback_test.c
-rw-r--r-- 1 devel devel  2278 Apr 27 06:48 rmii_mac_loopback.c
-rw-r--r-- 1 devel devel  4669 Apr 27 06:48 work.h
-rwxr-xr-x 1 devel devel 72912 May  2 13:44 work_test
-rw-r--r-- 1 devel devel  5810 Apr 27 06:48 work_test.c
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/net $ cd ../../test_mpremote/
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ ls
ethernet.bin  virtp.sh
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ . ./virtp.sh 
(env) devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ pip3 install mpremote
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Collecting mpremote
  Using cached mpremote-1.25.0-py3-none-any.whl (33 kB)
Collecting pyserial>=3.3
  Using cached https://www.piwheels.org/simple/pyserial/pyserial-3.5-py2.py3-none-any.whl (90 kB)
Installing collected packages: pyserial, mpremote
Successfully installed mpremote-1.25.0 pyserial-3.5
(env) devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ rm -f /media/devel/5221-0000/*.bin
(env) devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ cp ethernet.bin /media/devel/5221-0000/
(env) devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ ls /media/devel/5221-0000/
ethernet.bin
(env) devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ mpremote run test_ethernet.py 
devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/examples/net $ sudo ./work_test
CPU threads: 1
n 'work()'s: 1 
Total tx bytes: 8 
Total rx bytes: 4 
CPU took 0.000313 seconds to execute 
CPU iteration time: 0.000313 seconds
CPU bytes per sec: 38333.319117 B/s
FPGA took 0.000183 seconds to execute 
FPGA iteration time: 0.000183 seconds
FPGA bytes per sec: 65536.000000 B/s
Speedup: 1.709635
>>> (env) devel@pi5-90:~/pico-ice/PipelineC/pmod-ethernet/test_mpremote $ mpremote
Connected to MicroPython at /dev/ttyACM0
Use Ctrl-] or Ctrl-x to exit this shell

>>> from machine import Pin
>>> from machine import UART
>>> import ice
>>> fpga = ice.fpga(cdone=Pin(26), clock=Pin(24), creset=Pin(27), cram_cs=Pin(9), cram_mosi=Pin(8), cram_sck=Pin(10), frequency=12)
>>> file = open("ethernet.bin","br")
>>> fpga.start()
True
>>> fpga.cram(file)
>>> uart = UART(0, 115200)
>>> uart.init(115200, bits=8, parity=None, stop=1, tx=0, rx=1) # init with given parameters
>>> buffout = "abc"
>>> uart.write(buffout)
3
>>> uart.read(3)
>>> 
